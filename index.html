<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Birthday Surprise!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lobster&family=Poppins:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #1a202c;
            overflow: hidden; /* Hide scrollbars */
        }
        .font-handwriting {
            font-family: 'Lobster', cursive;
        }

        /* Animation Keyframes */
        @keyframes dropIn {
            from { transform: translateY(-100px) scale(0.8); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }
        .animate-drop-in {
            animation: dropIn 1.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
        @keyframes fadeInUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-fade-in-up {
            animation: fadeInUp 1.5s ease-out 0.5s forwards;
        }

        /* Sparkle styles */
        .sparkle {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 8px;
            height: 8px;
            background-color: #ffd700;
            border-radius: 50%;
            pointer-events: none;
            opacity: 0;
            animation: sparkle-effect 1.5s ease-out forwards;
            box-shadow: 0 0 10px #ffd700, 0 0 20px #fff;
        }

        @keyframes sparkle-effect {
            0% {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 1;
            }
            100% {
                transform: var(--sparkle-transform);
                opacity: 0;
            }
        }
        
        /* Sparkling Ribbon styles */
        .ribbon-particle {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 8px;
            height: 40px;
            background-color: #e91e63;
            pointer-events: none;
            opacity: 0;
            animation: fly-out 2.5s ease-out forwards;
            border-radius: 4px;
            box-shadow: 0 0 8px currentColor, 0 0 16px white;
        }

        @keyframes fly-out {
            0% {
                transform: translate(-50%, -50%) rotate(var(--initial-rotate)) scale(0.5);
                opacity: 1;
            }
            100% {
                transform: var(--ribbon-transform);
                opacity: 0;
            }
        }
        
        /* Mute Button Style */
        #mute-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background-color: rgba(0,0,0,0.5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1000;
            transition: background-color 0.3s;
        }
        #mute-btn:hover { background-color: rgba(0,0,0,0.7); }
        #mute-btn svg { stroke: white; }

        /* Countdown Style */
        #countdown {
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.7);
            animation: pulse 1s infinite;
            transition: opacity 0.5s ease-out;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        /* Start Screen Style */
        #start-screen {
            transition: opacity 0.5s ease-out;
        }

    </style>
</head>
<body class="flex items-center justify-center min-h-screen text-white">

    <!-- Start Screen -->
    <div id="start-screen" class="fixed inset-0 flex flex-col items-center justify-center bg-[#1a202c] z-50">
        <h1 class="font-handwriting text-6xl text-pink-400 mb-4">A Surprise is Waiting...</h1>
        <p class="text-xl text-gray-300 mb-8">Are you ready?</p>
        <button id="start-btn" class="bg-teal-500 hover:bg-teal-600 text-white font-bold py-4 px-10 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105">
            Click to Begin!
        </button>
    </div>

    <!-- Countdown Element (Initially Hidden) -->
    <div id="countdown" class="hidden absolute text-9xl font-bold text-yellow-300 z-30"></div>

    <!-- Main Content (hidden initially & positioned absolutely) -->
    <div id="main-content" class="text-center opacity-0 transition-opacity duration-1000 absolute pointer-events-none">
        <h1 class="font-handwriting text-7xl md:text-9xl text-yellow-300 drop-shadow-lg" style="opacity: 0;">Happy Birthday!</h1>
        <p class="mt-4 text-xl md:text-2xl text-gray-300" style="opacity: 0;">Wishing you a day as special as you are.</p>
        
        <a href="phase2.html" id="next-page-btn" class="opacity-0 mt-8 inline-block bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-all duration-1000 transform hover:scale-105">
            See The Memories &rarr;
        </a>
    </div>
    
    <!-- Sparkle/Ribbon Container -->
    <div id="effect-container" class="absolute top-0 left-0 w-full h-full pointer-events-none"></div>

    <!-- Audio player and Mute Button -->
    <audio id="background-music" loop src="background-music.mp3"></audio>
    <div id="mute-btn">
        <!-- Speaker Icon -->
        <svg id="speaker-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
        <!-- Mute Icon -->
        <svg id="mute-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hidden"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line></svg>
    </div>

    <script>
        const mainContent = document.getElementById('main-content');
        const effectContainer = document.getElementById('effect-container');
        const nextPageBtn = document.getElementById('next-page-btn');
        const countdownEl = document.getElementById('countdown');
        const startScreen = document.getElementById('start-screen');
        const startBtn = document.getElementById('start-btn');
        const audio = document.getElementById('background-music');

        function startExperience() {
            // Start the music immediately!
            if (audio.paused) {
                audio.play().catch(e => console.error("Audio play failed:", e));
            }

            // Show and start the countdown
            countdownEl.classList.remove('hidden');
            let count = 10;
            countdownEl.textContent = count;
            
            const countdownInterval = setInterval(() => {
                count--;
                if (count > 0) {
                    countdownEl.textContent = count;
                    createSparkles(25); // Mini sparkle burst
                    createRibbons(10);  // Mini ribbon burst
                } else {
                    clearInterval(countdownInterval);
                    
                    // Fade out countdown
                    countdownEl.style.opacity = '0';
                    
                    setTimeout(() => {
                        countdownEl.classList.add('hidden');
                        
                        // FINAL BURST
                        createSparkles(150); // The big explosion
                        createRibbons(60);   // The big explosion

                        // Show main content after a short delay
                        setTimeout(() => {
                            mainContent.style.pointerEvents = 'auto';
                            mainContent.style.opacity = '1';
                            mainContent.querySelector('h1').style.opacity = '1';
                            mainContent.querySelector('p').style.opacity = '1';
                            mainContent.querySelector('h1').classList.add('animate-drop-in');
                            mainContent.querySelector('p').classList.add('animate-fade-in-up');
                            // Fade out and stop the music when "Happy Birthday" appears
                            fadeOutMusic();
                        }, 500);

                        // Show the next page button after another delay
                        setTimeout(() => {
                            nextPageBtn.style.transition = 'opacity 1s ease-out';
                            nextPageBtn.style.opacity = '1';
                        }, 2500);

                    }, 500); // Wait for the fade out to finish
                }
            }, 1000);
        }

        function createSparkles(count = 150) {
            const sparkleCount = count;
            const colors = ['#ffeb3b', '#ffd700', '#fff59d', '#ffffff'];

            for (let i = 0; i < sparkleCount; i++) {
                const sparkle = document.createElement('div');
                sparkle.classList.add('sparkle');

                const angle = Math.random() * Math.PI * 2;
                const distance = Math.random() * (Math.max(window.innerWidth, window.innerHeight) * 0.6);
                const translateX = Math.cos(angle) * distance;
                const translateY = Math.sin(angle) * distance;

                sparkle.style.setProperty('--sparkle-transform', `translate(${translateX}px, ${translateY}px) scale(0)`);
                sparkle.style.animationDuration = `${1 + Math.random()}s`;
                sparkle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];

                effectContainer.appendChild(sparkle);
            }
        }

        function createRibbons(count = 60) {
            const ribbonCount = count;
            const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#ff4081', '#448aff'];

            for (let i = 0; i < ribbonCount; i++) {
                const ribbon = document.createElement('div');
                ribbon.classList.add('ribbon-particle');

                const angle = (Math.random() * 360);
                const distance = Math.random() * (Math.min(window.innerWidth, window.innerHeight) * 0.7);
                const translateX = Math.cos(angle * Math.PI / 180) * distance;
                const translateY = Math.sin(angle * Math.PI / 180) * distance;
                const finalRotate = (Math.random() - 0.5) * 1080;

                ribbon.style.setProperty('--initial-rotate', `${(Math.random() - 0.5) * 90}deg`);
                ribbon.style.setProperty('--ribbon-transform', `translate(${translateX}px, ${translateY}px) rotate(${finalRotate}deg) scale(0)`);
                ribbon.style.animationDuration = `${1.5 + Math.random() * 1.5}s`;
                ribbon.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                
                effectContainer.appendChild(ribbon);
            }
        }

        // --- CONTINUOUS MUSIC SCRIPT & FADE OUT ---
        const muteBtn = document.getElementById('mute-btn');
        const speakerIcon = document.getElementById('speaker-icon');
        const muteIcon = document.getElementById('mute-icon');

        function fadeOutMusic() {
            if (audio.muted || audio.volume === 0) {
                audio.pause();
                localStorage.setItem('musicPlaying', 'false');
                return;
            }

            let currentVolume = audio.volume;
            const fadeOutInterval = setInterval(() => {
                if (currentVolume > 0.1) {
                    currentVolume -= 0.1;
                    // Round to avoid floating point issues
                    audio.volume = Math.max(0, currentVolume);
                } else {
                    clearInterval(fadeOutInterval);
                    audio.pause();
                    audio.volume = 1; // Reset volume for the next page
                    localStorage.setItem('musicPlaying', 'false');
                }
            }, 100); // Fades out over 1 second
        }

        function saveMusicState() {
            localStorage.setItem('musicTime', audio.currentTime);
            localStorage.setItem('musicPaused', audio.muted);
        }

        function loadMusicState() {
            const time = localStorage.getItem('musicTime');
            const paused = localStorage.getItem('musicPaused') === 'true';
            
            if (time) {
                audio.currentTime = parseFloat(time);
            }
            
            audio.muted = paused;
            updateMuteButton(paused);

            if (localStorage.getItem('musicPlaying') === 'true' && !paused) {
                 audio.play().catch(e => console.log("Audio needs user interaction to play."));
            }
        }
        
        function updateMuteButton(isMuted) {
             if(isMuted) {
                speakerIcon.classList.add('hidden');
                muteIcon.classList.remove('hidden');
             } else {
                speakerIcon.classList.remove('hidden');
                muteIcon.classList.add('hidden');
             }
        }
        
        muteBtn.addEventListener('click', () => {
            audio.muted = !audio.muted;
            localStorage.setItem('musicPaused', audio.muted);
            updateMuteButton(audio.muted);
        });

        audio.onplay = () => localStorage.setItem('musicPlaying', 'true');
        audio.onpause = () => {
            if(!audio.muted) localStorage.setItem('musicPlaying', 'false');
        };

        // --- NEW START LOGIC ---
        startBtn.addEventListener('click', () => {
            // Fade out the start screen
            startScreen.style.opacity = '0';
            setTimeout(() => {
                startScreen.classList.add('hidden');
            }, 500); // Match this with the CSS transition duration

            // Start the main experience
            startExperience();
        });

        window.addEventListener('DOMContentLoaded', () => {
            // We set musicPlaying to false initially on the first page
            localStorage.setItem('musicPlaying', 'false');
            loadMusicState();
        });
        window.addEventListener('beforeunload', saveMusicState);
    </script>
</body>
</html>

